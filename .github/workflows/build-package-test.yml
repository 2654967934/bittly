name: Build Test Package

# @link : https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch
on: workflow_dispatch

jobs:
  # build windows package for testing
  build-window-packages:
    runs-on: windows-2022
    steps:
      # # node.js
      # - uses: actions/setup-node@v3
      #   with:
      #     node-version: 16.14.2
      
      # # python2
      # - uses: actions/setup-python@v4
      #   with:
      #     python-version: 2.7 

      # # python3
      # - uses: actions/setup-python@v4
      #   with:
      #     python-version: 3.11
      
      # # msbuild
      # - uses: microsoft/setup-msbuild@v1.1
      #   with:
      #     vs-version: 15.9

      # # checkout 
      # - uses: actions/checkout@v1

      # - run: npm install --python=python2.7

      # - run: npm run electron:build -- --x64

      # - name: Extract version
      #   id: package-json
      #   uses: Saionaro/extract-package-version@v1.0.6
      
      - run: Invoke-RestMethod -Uri 'https://res.bittly.sigechen.com/download/0.15.2/bittly-0.15.2-x64.exe' -OutFile 'test.exe'
      - run: ls
      - name: Send test package to testers
        uses: dawidd6/action-send-mail@v3
        with:
          connection_url: ${{secrets.MAIL_CONNECTION}}
          server_port: 465
          secure: true
          subject: Github Actions job result
          to: ${{secrets.EMAIL_TESTER_ADDRESS}}
          from: Github Actions Workflow Job
          body: Build job of ${{github.repository}} completed successfully!
          ignore_cert: true
          attachments: ./test.exe
          #attachments: ./dist_electron/bittly-$VERSION-win-x64.exe
        env:
          VERSION: ${{steps.package-json.outputs.version}}